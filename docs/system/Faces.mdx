## Overview

Faces is a project to animate the face of the Sawyer Robot and control both verbal and non-verbal communication with users. It is implemented in dart and flutter with a c++ ffi for publishing the face to the robot. The animation is done with a Flare file created on [rive.app](https://rive.app/).

The code for this project is in: `communication/faces`

---

### Faces

![Faces example](/img/faces.jpg)

### Rive.app

![Rive.app](/img/Rive.app.jpg)

### Emotions

Below are the different faces currently available.

(a) Neutral

(b) Happy

(c) Surprised

(d) Angry

(e) Sad

![Emotions](/img/Expressions1.png)

### Controls

- Facial Emotions
- Animations
- Blinking
- Speech & Speech Animation

### Communicates with:

- Rospublisher 'vision/face_tracking' located in vision_pipeline/scripts/face_tracker.py
- Rospublisher 'eyes/method' located in robot_control/scripts/robot_services.py
- Rospublisher 'eyes/method' located in communication/speech/speech_app/lib/speech/subscribers.dart
- SimpleActionClient 'face_say' located in game/game_flow/Robot/sawyer_bot.py

### Topics Subscribed To:

#### Hand Detection

- name: 'vision/hand_detection',
- type: '/common_msgs/HandDetected',

#### Chat

- name: 'verified_speech',
- type: '/common_msgs/ChatMessage',

#### Eyes Method

- name: 'eyes/method',
- type: 'common_msgs/LookAt',

- lookAtMethods:
  'stop': 0,
  'down': 1,
  'wander': 2,
  'human': 3,
  'straight': 4,
  'left': 5,
  'right': 6,
  'up': 7,
  'hand': 8,

#### Face Tracking

- name: 'vision/face_tracking',
- type: 'common_msgs/XY_new',

### Commands:

- rosservice call face/change_emotion [letter of emotion]
  \*\*Emotions: 'n' - Neutral Face 'h' - Happy Face 'a' - Angry Face 's' - Surprised Face 'd' - Sad

---

### To run from sawyer_ws:

- `cd src/communication/faces`

- `flutter run -d Linux`

### To run face tracking:

- `rosrun vision_pipeline face_tracker.py`

Files:
faces/assets/Sawyer Face.flr (Flare File of All Face Animations)
faces/assets/cmudict-modified.txt (files of syllables for the sylllablizer)

src/sawyer-demo.json (file for logging to google text to speech account)

Folders:
faces/assets/speech_files: contains mp3 files for speech
